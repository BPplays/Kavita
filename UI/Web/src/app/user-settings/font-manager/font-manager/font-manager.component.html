<ng-container *transloco="let t; read:'font-manager'">
  <div class="container-fluid">
    <div class="row mb-2">
      <h3>{{t('title')}}</h3>
    </div>

    <p>{{t('description')}}</p>

    <div class="d-flex justify-content-center flex-grow-1">
      <div class="card d-flex col-lg-9 col-md-7 col-sm-4 col-xs-4 p-3">

        <div class="row mb-3">
          <div class="mx-auto">
            <div class="d-flex justify-content-center">
              <div class="d-flex justify-content-evenly">
                {{t('preview-default')}}
              </div>
            </div>
          </div>
        </div>

        @if (isUploadingFont) {
          <app-loading [loading]="isUploadingFont"></app-loading>
        } @else {
          <form [formGroup]="form">
          <ngx-file-drop (onFileDrop)="dropped($event)" [accept]="acceptableExtensions" [directory]="false"
                         dropZoneClassName="file-upload" contentClassName="file-upload-zone">
            <ng-template ngx-file-drop-content-tmp let-openFileSelector="openFileSelector">
              <div class="row g-0 p-3" *ngIf="mode === 'all'">
                <div class="mx-auto">
                  <div class="row g-0 mb-3">
                    <i class="fa fa-file-upload mx-auto" style="font-size: 24px; width: 20px;" aria-hidden="true"></i>
                  </div>

                  <div class="d-flex justify-content-center">
                    <div class="d-flex justify-content-evenly">
                      <a class="pe-0" href="javascript:void(0)" (click)="changeMode('url')">
                        <span class="phone-hidden">{{t('enter-an-url-pre-title', {url: ''})}}</span>{{t('url')}}
                      </a>
                      <span class="ps-1 pe-1">•</span>
                      <span class="pe-0" href="javascript:void(0)">{{t('drag-n-drop')}}</span>
                      <span class="ps-1 pe-1">•</span>
                      <a class="pe-0" href="javascript:void(0)" (click)="openFileSelector()">{{t('upload')}}<span class="phone-hidden"> {{t('upload-continued')}}</span></a>
                    </div>
                  </div>
                </div>
              </div>


              <ng-container *ngIf="mode === 'url'">
                <div class="row g-0 mt-3 pb-3 ms-md-2 me-md-2">
                  <div class="input-group col-auto me-md-2" style="width: 83%">
                    <label class="input-group-text" for="load-font">{{t('url-label')}}</label>
                    <input type="text" autofocus autocomplete="off" class="form-control" formControlName="fontUrl" placeholder="https://" id="load-font">
                    <button class="btn btn-outline-secondary" type="button" id="load-font-addon" (click)="uploadFromUrl(); mode='all';" [disabled]="(form.get('fontUrl')?.value).length === 0">
                      {{t('load')}}
                    </button>
                  </div>
                  <button class="btn btn-secondary col-auto" href="javascript:void(0)" (click)="mode = 'all'">
                    <i class="fas fa-share" aria-hidden="true" style="transform: rotateY(180deg)"></i>&nbsp;
                    <span class="phone-hidden">{{t('back')}}</span>
                  </button>
                </div>

              </ng-container>

            </ng-template>
          </ngx-file-drop>
          </form>
        }

      </div>
    </div>

    <div class="row mt-3 mb-3 g-0">
      <div class="scroller">
        <div class="pe-2">
          <ul style="height: 100%" class="list-group list-group-flush">

            @for (font of fontService.fonts$ | async; track font.name) {
              <ng-container [ngTemplateOutlet]="availableFont" [ngTemplateOutletContext]="{ $implicit: font}"></ng-container>
            }
          </ul>
        </div>
      </div>
    </div>

  </div>

  <ng-template #availableFont let-item>
    <li class="list-group-item d-flex flex-column align-items-start border-bottom border-info">
      <div class="d-flex justify-content-between w-100">
        <div class="ms-2 me-auto fs-5">
          <div class="fw-bold">{{item.name | sentenceCase}}</div>
        </div>

        <div class="d-flex justify-content-end">
          @if (item.hasOwnProperty('provider') && item.provider === FontProvider.User && item.hasOwnProperty('id')) {
            <button class="btn btn-danger me-1" (click)="deleteFont(item.id)">{{t('delete')}}</button>
          }

          <div *ngIf="item.hasOwnProperty('provider')" class="align-self-center">
            <span class="pill p-1 mx-1 provider">{{item.provider | siteThemeProvider}}</span>
          </div>

        </div>
      </div>


      <span class="p-1 me-1 preview mt-2 flex-grow-1 text-center w-100 fs-4 fs-lg-3" [ngStyle]="{'font-family': item.name, 'word-break': 'keep-all'}">
            The quick brown fox jumps over the lazy dog
      </span>
    </li>
  </ng-template>



</ng-container>
